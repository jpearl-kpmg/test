

trigger:
- master

stages:
- stage: ChangeJob
  jobs:

  - job: 'ChangeJob'
    pool: server
    steps:

    - task: ServiceNow-DevOps-Server-Job-Notification@1
      inputs:
        connectedServiceName: 'DevOps Connection'
        Phase: 'STARTED'

    - task: ServiceNow-DevOps-Server-Package-Registration@1
      inputs:
        connectedServiceName: 'DevOps Connection'
        packageRegistrationPayload: |
          {
              "name": "CorpsitePackage",
              "artifacts": [
              {
                  "name": "globex-web.war",
                  "repositoryName": "corpsite-ADO",
                  "version": "1.0.$(ChangeJob.ChangeJobId)",
                  "pipelineName":"$(system.teamProject)/$(ChangeJob.definitionName)",
                  "taskExecutionNumber":"$(ChangeJob.ChangeJobId)",
                  "stageName":"$(system.jobDisplayName)",
                  "branchName":"$(ChangeJob.sourceBranchName)"
              }],
              "pipelineName":"$(system.teamProject)/$(build.definitionName)",
              "taskExecutionNumber":"$(ChangeJob.ChangeJobId)",
              "stageName":"$(system.jobDisplayName)",
              "branchName":"$(ChangeJob.sourceBranchName)"
          }
        artifactToolIdExists: false
    - task: ServiceNow-DevOps-Server-Change-Acceleration@1
      inputs:
        connectedServiceName: 'DevOps Connection'

    - task: ServiceNow-DevOps-Server-Artifact-Registration@1
      inputs:
        connectedServiceName: 'DevOps Connection'
        artifactToolIdExists: false
        artifactRegistrationPayload: |
          {
            "artifacts": [
            {
                "name": "globex-web.war",
                "repositoryName": "CorpSite-ADO",
                "version": "1.0.$(ChangeJob.ChangeJobId)",
                "semanticVersion": "1.0.$(ChangeJob.ChangeJobId)"
            }]
          }

    - task: ServiceNow-DevOps-Server-Job-Notification@1
      inputs:
        connectedServiceName: 'DevOps Connection'
        Phase: 'COMPLETED'





